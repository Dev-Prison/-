# 경계 간 매핑하기

> 매핑 전략에 찬성하는 의견

    두 계층 간에 매핑을 하지 않으면 양 계층에서 같은 모델을 사용해야 하는데 이렇게 하면 두 계층이 강하게 결합된다.

> 매핑 전략에 반대하는 의견

    두 계층 간에 매핑을 하게 되면 코드 중복이 너무 많이 일어난다.
    많은 유스케이스들이 오직 CRUD만 수행하고 계층에 걸쳐 같은 모델을 사용하기 때문에 계층 사이의 매핑은 과하다.

두 의견 모두 일정 부분 맞다. 몇가지 매핑 전략을 장단점과 함께 살펴보며 언제 어떤 전략을 사용하면 좋을지 생각해보자. <br><br>


## 1) 매핑하지 않기 전략

<img width="741" alt="1" src="https://user-images.githubusercontent.com/48689213/210478109-c8fcbcab-5761-4cf8-94ad-47caed43083c.png">

지금부터 살펴볼 그림들은 앞에서 보았던 '송금하기' 유즈케이스 구조를 도식화 한 것이다.

이 그림 에서는 웹 계층(컨트롤러)과 어플리케이션 계층(서비스), 영속성 계층(레포지토리)이 모두 ```Account``` 도메인 모델을 전용 모델로 사용하고 있다.

즉 계층간 매핑이 전혀 이루어지지 않았으며, 세 계층이 하나의 ```Account``` 도메인 모델을 공유하여 사용하고 있고, 이런 형태를 '매핑하지 않기 전략' 이라 부른다. <br><br>


> 매핑하지 않기 전략의 장점

모든 계층이 정확히 같은 구조의 같은 정보를 필요로 한다면 매핑하지 않기 전략은 완벽한 선택지이다.

예를 들어 간단한 CRUD 유즈케이스의 경우, 컨트롤러 계층의 모델과 레포지토리 계층의 모델의 코드가 완전히 동일하면 계층마다 별도의 모델을 둘 필요가 없다. <br><br>


> 매핑하지 않기 전략의 단점

컨트롤러 계층의 필요로 ```Account``` 모델에 어노테이션을 추가하거나, 어플리케이션 계층의 필요로 ```Account``` 모델에 특정 커스텀 필드를 둬야하는 등

모든 계층이 같은 구조의 같은 정보를 필요로 하지 않을 수 있다.

이 때 매핑하지 않기 전략을 사용하면 단일 책임 원칙(클래스를 변경하는 이유는 오로지 하나여야 한다)을 위배하게 된다.

```Account``` 모델 클래스를 변경하는 이유가 컨트롤러, 서비스, 레포지토리 계층 총 세가지나 되기 때문이다. <br><br>


## 2) 양방향 매핑 전략

<img width="742" alt="2" src="https://user-images.githubusercontent.com/48689213/210478120-266582b9-e7db-44a2-981b-85bc07c1cc24.png">

각 계층이 전용 모델을 가지는 매핑 전략을 '양방향 매핑 전략' 이라고 한다.

위 그림처럼 양방향 매핑 전략에서는 각 계층이 도메인 모델과 완전히 다른 구조의 전용 모델을 갖는다.

<img width="742" alt="2" src="https://user-images.githubusercontent.com/48689213/211154371-29229ddc-c8d7-48c2-a9eb-34c387a10bf7.png">

각 계층에서는 입력 받은 전용 모델을 도메인 모델로 매핑되기도 하고, 도메인 모델이 다시 전용 모델로 매핑되기도 하기 때문에 양방향 매핑이라고 부른다. <br><br>


> 양방향 매핑 전략의 장점

각 계층이 전용 모델을 가지고 있기 때문에 각 계층에서 모델을 변경하더라도 다른 계층에 영향이 없다.

즉 단일 책임 원칙을 만족하는 구조가 된다.

또한 개념적으로는 '매핑하지 않기' 전략 다음으로 간단하다. 매핑 책임이 명확하기 때문이다.

바깥쪽 계층/어댑터에서 해당 계층 모델을 안쪽 계층 모델로 매핑하고, 다시 안쪽 계층 모델을 해당 계층 모델로 매핑하기 때문에

안쪽 계층은 


> 양방향 매핑 전략의 단점


## 3) 완전 매핑 전략

<img width="742" alt="3" src="https://user-images.githubusercontent.com/48689213/210478131-79ce89ef-d759-4d96-b10e-b8fac246c265.png">

ㅇㅇㅇ

## 4) 단방향 매칭 전략

<img width="742" alt="4" src="https://user-images.githubusercontent.com/48689213/210478140-c5b715a5-b961-43cf-b945-95c13fa1800a.png">

ㅇㅇㅇ

## 매핑 전략 선택 방법

매핑 전략 선택 방법

## 정리

어떤 매핑 전략을 선택했더라도 나중에 언제든 바꿀 수 있다.

따라서 처음에는 단순한 매핑 전략을 사용하다가, 시간이 지남에 따라 유즈케이스가 고도화되면서

조금 더 높은 수준의 매핑 전략을 사용하는 것도 좋은 방법이다.
